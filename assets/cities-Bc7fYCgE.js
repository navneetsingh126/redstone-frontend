import{a as q,g as H,r as a,b as Q,j as e,s as _,h as $,f as J,e as F,aj as K,aO as V,aP as w,aQ as D,B as N,n as T,I as R,S as X,ae as Y,q as A,V as Z}from"./index-BGzCyL09.js";import{D as ee}from"./content-Ble_FClL.js";import{C as B}from"./Card-C67Gdxkn.js";import{G as E}from"./Grid-B_yfiKT6.js";import{T as M}from"./TextField-CvY74_4W.js";import{T as se}from"./TableContainer-Dgo4ys7V.js";import{c as te,b as ae,T as v,a as u,d as ne}from"./TableRow-D3nUyhUt.js";import{a as oe}from"./TablePagination-BHC551Ol.js";import{D as re,a as ie,b as le,c as ce}from"./DialogTitle-CZMQigF_.js";import"./Select-Bbj5hnnA.js";import"./KeyboardArrowRight-De6O87F_.js";import"./LastPage-IufPiMCw.js";function de(t){return q("MuiDialogContentText",t)}H("MuiDialogContentText",["root"]);const ue=t=>{const{classes:n}=t,c=J({root:["root"]},de,n);return{...n,...c}},xe=_(F,{shouldForwardProp:t=>K(t)||t==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(t,n)=>n.root})({}),ge=a.forwardRef(function(n,l){const c=Q({props:n,name:"MuiDialogContentText"}),{children:P,className:g,...r}=c,d=ue(r);return e.jsx(xe,{component:"p",variant:"body1",color:"textSecondary",ref:l,ownerState:r,className:$(d.root,g),...c,classes:d})});function he(){const t=Ce(),{showSnackbar:n}=V(),[l,c]=a.useState([]),[P,g]=a.useState(!0),[r,d]=a.useState(""),[C,m]=a.useState(!1),[p,j]=a.useState(null),[h,x]=a.useState(!1),[f,y]=a.useState(null),[o,i]=a.useState(""),b=a.useCallback(async()=>{try{g(!0);const s=await w.get(D.cities.list);c(s.data)}catch(s){console.error("Error fetching cities:",s),n("Failed to load cities","error")}finally{g(!1)}},[n]);a.useEffect(()=>{b()},[b]);const k=l.filter(s=>s.name.toLowerCase().includes(r.toLowerCase())),O=!k.length&&!!r,G=async()=>{if(o.trim())try{const s=await w.post(D.cities.create,{name:o.trim()});c([...l,s.data]),i(""),n("City added successfully","success")}catch(s){console.error("Error adding city:",s),n("Failed to add city","error")}else n("Please enter a city name","warning")},U=s=>{y(s),i(s.name),x(!0)},L=async()=>{if(f&&o.trim())try{const s=await w.put(D.cities.update(f.id),{name:o.trim()});c(l.map(S=>S.id===f.id?s.data:S)),i(""),x(!1),y(null),n("City updated successfully","success")}catch(s){console.error("Error updating city:",s),n("Failed to update city","error")}else o.trim()||n("Please enter a city name","warning")},W=s=>{j(s),m(!0)},z=async()=>{if(p)try{await w.delete(D.cities.delete(p)),c(l.filter(s=>s.id!==p)),m(!1),j(null),n("City deleted successfully","success")}catch(s){console.error("Error deleting city:",s),n("Failed to delete city","error")}},I=()=>{m(!1),j(null)};return e.jsxs(ee,{children:[e.jsx(N,{sx:{mb:5,display:"flex",alignItems:"center"},children:e.jsx(F,{variant:"h4",sx:{flexGrow:1},children:"Manage Cities"})}),e.jsxs(B,{sx:{mb:3,p:3},children:[e.jsx(F,{variant:"h6",sx:{mb:2},children:h?"Edit City":"Add New City"}),e.jsxs(E,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(E,{size:{xs:12,sm:6},children:e.jsx(M,{label:"City Name",variant:"outlined",value:o,onChange:s=>i(s.target.value),fullWidth:!0})}),e.jsx(E,{size:{xs:12,sm:6},children:e.jsxs(N,{sx:{display:"flex",gap:1},children:[e.jsx(T,{variant:"contained",onClick:h?L:G,startIcon:e.jsx(R,{icon:"mingcute:add-line"}),sx:{backgroundColor:"black",borderRadius:1},children:h?"Save":"Add City"}),h&&e.jsx(T,{variant:"outlined",onClick:()=>{x(!1),y(null),i("")},children:"Cancel"})]})})]})]}),e.jsxs(B,{children:[e.jsx(N,{sx:{p:3},children:e.jsx(M,{label:"Search City",variant:"outlined",fullWidth:!0,value:r,onChange:s=>d(s.target.value),sx:{mb:2}})}),e.jsx(X,{children:e.jsx(se,{sx:{overflow:"unset"},children:e.jsxs(te,{sx:{minWidth:800},children:[e.jsx(ae,{children:e.jsxs(v,{children:[e.jsx(u,{children:"S.No"}),e.jsx(u,{children:"City Name"}),e.jsx(u,{children:"Actions"})]})}),e.jsx(ne,{children:P?e.jsx(v,{children:e.jsx(u,{colSpan:3,sx:{textAlign:"center",py:3},children:e.jsx(Y,{})})}):e.jsxs(e.Fragment,{children:[k.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage).map((s,S)=>e.jsxs(v,{children:[e.jsx(u,{children:t.page*t.rowsPerPage+S+1}),e.jsx(u,{children:s.name}),e.jsxs(u,{children:[e.jsx(A,{onClick:()=>U(s),children:e.jsx(R,{icon:"solar:pen-bold"})}),e.jsx(A,{onClick:()=>W(s.id),children:e.jsx(R,{icon:"solar:trash-bin-trash-bold"})})]})]},s.id)),O&&e.jsx(v,{children:e.jsx(u,{colSpan:3,sx:{textAlign:"center"},children:"No cities found"})})]})})]})})}),e.jsx(oe,{component:"div",page:t.page,count:k.length,rowsPerPage:t.rowsPerPage,onPageChange:t.onChangePage,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:t.onChangeRowsPerPage})]}),e.jsxs(re,{open:C,onClose:I,children:[e.jsx(ie,{children:"Confirm Delete"}),e.jsx(le,{children:e.jsx(ge,{children:"Are you sure you want to delete this city?"})}),e.jsxs(ce,{children:[e.jsx(T,{onClick:I,children:"Cancel"}),e.jsx(T,{onClick:z,color:"error",variant:"contained",children:"Delete"})]})]})]})}function Ce(){const[t,n]=a.useState(0),[l,c]=a.useState("name"),[P,g]=a.useState(5),[r,d]=a.useState([]),[C,m]=a.useState("asc"),p=a.useCallback(o=>{m(l===o&&C==="asc"?"desc":"asc"),c(o)},[C,l]),j=a.useCallback((o,i)=>{if(o){d(i);return}d([])},[]),h=a.useCallback(o=>{const i=r.includes(o)?r.filter(b=>b!==o):[...r,o];d(i)},[r]),x=a.useCallback(()=>{n(0)},[]),f=a.useCallback((o,i)=>{n(i)},[]),y=a.useCallback(o=>{g(parseInt(o.target.value,10)),x()},[x]);return{page:t,order:C,onSort:p,orderBy:l,selected:r,rowsPerPage:P,onSelectRow:h,onResetPage:x,onChangePage:f,onSelectAllRows:j,onChangeRowsPerPage:y}}function ke(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:`Cities - ${Z.appName}`}),e.jsx(he,{})]})}export{ke as default};
